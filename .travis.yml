language: node_js
cache:
  directories:
  - webapp/
node_js:
- stable
before_install:
- openssl aes-256-cbc -K $encrypted_887081f0f551_key -iv $encrypted_887081f0f551_iv -in secrets.tar.enc -out secrets.tar -d
- tar -xvf secrets.tar
- git submodule init
- cd webapp
- git checkout master -f
- git pull origin master
- cd open-budget
install:
- npm install
script: 
- npm run lint && npm run build 
- cd ../../open-budget-il

deploy:
  provider: gae
  keyfile: open-budget-il-aaf0a776a535.json
  project: open-budget-il
  version: staging
  no_promote: true
  on: 
    branch: travis-deploy
